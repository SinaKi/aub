\subsection{Randomisierter Quicksort Algorithmus}
\paragraph*{1. Versuch einer Analyse:} Was ist die erwartete Größe von $A_L$/$A_R$?
%TODO

\paragraph*{2. Versuch einer Analyse:} Seien die zu sortierenden Elemente in $A$ $s_1,s_2,s_3,\dots,s_n$ mit $s_1<s_2<s_3<\dots<s_n$.
Definiere die Zufallsvariable
\begin{equation}
   X_{ij} =
   \begin{cases}
     1 & \text{falls } s_i \text{ mit } s_j \text{ während Quicksort verglichen wurde} \\
     0 & sonst
   \end{cases}
\end{equation}
\paragraph*{Offensichtlich gilt} Anzahl der Vergleiche im Quicksort-Run = Gesamtlaufzeit ist $\sum\limits_{i<j} X_{ij}$
Uns interessiert $E(\sum\limits_{i<j} X_{ij})$
\paragraph*{Uns interessiert} $$E(\sum\limits_{i<j} X_{ij})
= \sum\limits_{i<j} X_{ij} 
= \sum\limits_{i<j}(Pr(x_{ij}=0) \cdot 0 + Pr(X_{ij}=1) \cdot 1) 
= \sum\limits_{i<j} \underbrace{Pr(X_{ij}=1)}_{\frac{2}{j-i+1}} 
= \sum\limits_{i<j} \frac{2}{j-i+1}$$
$$= \sum\limits_{i=1}^{n-1} \underbrace{\sum\limits_{j=i+1}^n \frac{2}{j-i+1}}_{\frac{2}{2}+\frac{2}{3}+\frac{2}{4}+\frac{2}{5}+\dots+\frac{2}{n-i+1}} 
= \sum\limits_{i=1}^{n-1} \sum\limits_{j=2}^{n-i+1} \frac{2}{j}
= 2 \cdot \sum\limits_{i=1}^{n-1} \underbrace{\sum\limits_{j=2}^{n-i+1} \frac{1}{j}}_{<H_n~~\log n} 
= O(n \log n) $$ %TODO notiz, ~~ zu etwa,sum

\paragraph*{Jetzt} Berechnung von $P(X_{ij}=1) =: p_{ij}$ Stelle den Ablauf von Quicksort als Rekursion dar, schreibe in die Knoten die jeweiligen Pivotelemente der entsprechenden Rekursion. Wie zählen die Pivotelemente von oben nach unten und von links nach rechts durch. $\Rightarrow$ Wir erhalten eine Permutation $\Pi$ der Eingabeelemente.
%TODO graph
$\Pi = p_1 p_2 p_3 \cdots p_n = s_{20} s_{10} s_{25} s_{5} \cdots$
\paragraph*{Anmerkung} $\Pi$ ist nicht zufällig gleichverteilt, da manche Permutationen gar nicht vorkommen können. z.B. $\Pi = s_{50} s_{10} s_{20} mit n=100$. Wie schaut $\Pi$ aus, wenn $s_i$ \underline{nicht} mit $s_j$ verglichen wurde? Dann taucht ein Element $s_k$, $i<k<j$ als Pivotelement von $s_i$ und $s_j$ in $\Pi$ auf.\\

\framebox[1.1\width]{$s_i$ wird mit $s_j$ verglichen genau dann wenn $s_i$ oder $s_j$ das erste Element aus $\{ s_i,s_{i-1},s_{i-2},\dots,s_j \}$ in $\Pi$ ist.}

\paragraph*{} Mit gleicher Wahrscheinlichkeit ist jedes Element $\{ s_i,\dots,s_j \}$ das erste Element, welches in $\Pi$ auftaucht. $\Rightarrow$ Pr($s_i$ mit $s_j$ verglichen wird) $= \frac{2}{j-i+1}$

\paragraph*{Auch interessant} die Wahrscheinlichkeit, dass Quicksort deutlich länger als $~n \log n$ Schritte braucht.

%TODO graphen

\paragraph*{} Quicksort hat eine erwartete Laufzeit von $O(n \log n)$, aber er besteht immer die Möglichkeit, dass Quicksort $~n^2$ Schritte braucht. Man hätte gerne eine Aussage, wie wahrscheinlich das ist.Allgemein interessiert uns für eine Zufallsvariable $X$ (nicht-negativ) mit Erwartungswert $E(X)$, mit welcher Wahrscheinlichkeit $X$ stark (nach oben) von $E(X)$ abweicht. %TODO tilde anzeigen

\paragraph*{1. Versuch} Markov Ungleichung $(Pr(X \geq t) \leq \frac{E(X)}{t})$ also $Pr(X \geq \alpha \cdot E(X)) \leq \frac{1}{\alpha}$ mit $\alpha \geq 1$.

\paragraph*{} Für einen Algorithmus mit $E(X) = n \log n$
\begin{itemize}
	\item haben wir mindestens Konstante Wahrscheinlichkeit, dass wir nicht mehr als einen konstanten Faktor vom Erwartungswert abweichen, z.B. $Pr(X \geq 10 \cdot n \log n) \leq \frac{1}{10}$.
	\item haben wir \underline{hohe} Wahrscheinlichkeit, dass wir vom Erwartungswert nicht mehr als Faktor $n$ abweichen.
	\item haben wir \underline{sehr hohe} Wahrscheinlichkeit, dass wir vom Erwartungswert nicht mehr als Faktor $2^n$ abweichen.
\end{itemize}

$$ Pr(X > 2^n \cdot \log n) \leq \frac{1}{2^n} $$

\paragraph*{} Diese Schranken für Konzentration um den Erwartungswert sind schlecht, da die Markov- Ungleichung \underline{nur} den Erwartungswert einbezieht, nicht die Verteilung der Zufallsvariablen.

\paragraph*{Bsp.:}
\begin{tabular}{l l}
$X_1 :$ & $Pr(X_1 = 3003) = \frac{1}{2}$ \\
 & $Pr(X_1 = 2997) = \frac{1}{2}$ \\
 & $E(X_1) = 3000$ \\
$X_2 :$ & $Pr(X_2 = 1) = \frac{1}{2}$ \\
 & $Pr(X_2 = 5999) = \frac{1}{2}$ \\
 & $E(X_2) = 3000$ \\
\end{tabular} 

\paragraph*{} Man kann beweisen, dass z.B. bei Random Quicksort die Laufzeit $X$ stark um den Erwartungswert konzentriert ist,  \underline{aber schwierig}.

\paragraph*{Jetzt} Zeige generische Modifikation für beliebige Las Vegas Algorithmen, welche starke Konzentration um den Erwartungswert sicherstellt.

\paragraph*{Idee} Simulation eines Bernoullieexperiments \\
\framebox[1.1\width]{lasse Algorithmus $A$ $k \cdot E(X)$ Schritte laufen; falls bis dahin fertig $\rightarrow$ alles gut, sonst starte neu.}

\paragraph*{Markov} $\Rightarrow Pr(A$ in $\leq k \cdot E(X)$ Schritten zum Schluss kommt $) = Pr(X \leq k \cdot E(X) = 1 - Pr(X<k \cdot E(X) = 1 - \frac{1}{k}))$ 

\paragraph*{z.B.} $K=2$ $Pr($Algorithmus berechnet im maximal doppelter erwarteter Laufzeit das Ergebnis$) \geq \frac{1}{2}$ \dots